use backend::{
    planetscale::{PlanetScale, PlanetScaleConfig},
    tracing::tracing_subscribe,
    Result,
};
use std::env;
use ureq::AgentBuilder;

fn main() -> Result<()> {
    tracing_subscribe().expect("Tracing subscription failed.");

    let home_dir = env::var("HOME").unwrap();

    let agent = AgentBuilder::new().https_only(true).build();
    let config = PlanetScaleConfig::new(format!("{home_dir}/.config/planetscale").as_str())?;

    let planetscale = PlanetScale::new(agent, &config);

    let organizations = planetscale.org().list()?;

    for organization in organizations.data {
        println!("{}", &organization.name);
    }

    Ok(())
}

/// PlanetScale GUI tool that simplify your local development workflow.
#[derive(clap::Parser)]
#[clap(about, long_about=None, version)]
struct Cli {
    #[clap(subcommand)]
    command: Command,

    /// PlanetScale CLI config directory. Defaults to $HOME/.config/planetscale.
    #[clap(long, value_parser)]
    config_dir: Option<String>,

    /// Use custom service token instead of the default token generated by `pscale auth login`.
    #[clap(long, value_parser)]
    service_token: Option<String>,
}

#[derive(clap::Subcommand)]
enum Command {
    /// Start the Voyager web dashboard.
    Dashboard,
}
